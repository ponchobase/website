/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/@flyskywhy/gifuct-js@3.0.0/lib/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decompressFrames=exports.decompressFrame=exports.parseGIF=void 0;var _gif=_interopRequireDefault(require("js-binary-schema-parser/lib/schemas/gif")),_jsBinarySchemaParser=require("js-binary-schema-parser"),_uint=require("js-binary-schema-parser/lib/parsers/uint8"),_imageData=_interopRequireDefault(require("@canvas/image-data")),_deinterlace=require("./deinterlace"),_lzw=require("./lzw");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function ownKeys(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,t)}return a}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(a),!0).forEach((function(r){_defineProperty(e,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))}))}return e}function _defineProperty(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}var parseGIF=function(e){var r=new Uint8Array(e);return(0,_jsBinarySchemaParser.parse)((0,_uint.buildStream)(r),_gif.default)};exports.parseGIF=parseGIF;var generatePatch=function(e){for(var r=e.pixels.length,a=new Uint8ClampedArray(4*r),t=0;t<r;t++){var i=4*t,s=e.pixels[t];if(s!==e.transparentIndex){var n=e.colorTable[s]||[0,0,0];a[i]=n[0],a[i+1]=n[1],a[i+2]=n[2],a[i+3]=255}}return a},decompressFrame=function(e,r,a){if(e.image){var t=e.image,i=t.descriptor.width*t.descriptor.height,s=(0,_lzw.lzw)(t.data.minCodeSize,t.data.blocks,i);t.descriptor.lct.interlaced&&(s=(0,_deinterlace.deinterlace)(s,t.descriptor.width));var n={pixels:s,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return t.descriptor.lct&&t.descriptor.lct.exists?n.colorTable=t.lct:n.colorTable=r,e.gce?(n.delay=10*(e.gce.delay||10),n.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(n.transparentIndex=e.gce.transparentColorIndex)):n.delay=100,a&&(n.patch=generatePatch(n)),n}console.warn("gif frame does not have associated image.")};exports.decompressFrame=decompressFrame;var generateImageData=function(e,r){for(var a=e.lsd,t=a.width,i=a.height,s=!1,n=0;n<r.length;n++){var o=r[n];if(t*i*4===o.patch.length)o.imageData=new _imageData.default(o.patch,t,i);else if(n>0){var c=new _imageData.default(new Uint8ClampedArray(r[n-1].imageData.data),t,i),p=o.dims.left,d=o.dims.top,l=o.dims.width,m=o.dims.height,f=o.patch,u=void 0;if(s){for(var g=0;g<m;g++)for(var h=0;h<l;h++){var v=4*((g+d)*t+h+p);c.data[v++]=0,c.data[v++]=0,c.data[v++]=0,c.data[v]=0}s=!1}for(var b=0;b<m;b++)for(var y=0;y<l;y++)if(f[(u=4*(b*l+y))+3]>0){var w=4*((b+d)*t+y+p);c.data[w++]=f[u++],c.data[w++]=f[u++],c.data[w++]=f[u++],c.data[w]=f[u]}2===o.disposalType&&(s=!0),o.imageData=c}}},decompressFrames=function(e,r,a){var t=e.frames.length?e.frames[0].gce:void 0,i=e.frames.filter((function(e){return e.image})).map((function(a){return decompressFrame(_objectSpread({gce:t},a),e.gct,r)}));return r&&a&&generateImageData(e,i),i};exports.decompressFrames=decompressFrames;
//# sourceMappingURL=/sm/40887e8f51922370552e0fe7c39384883440005f6929da5e6ab9ea43cae88030.map